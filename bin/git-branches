#!/bin/bash
set -euo pipefail

if [ "$#" -ne 1 ]; then
    echo "Usage: $(basename "$0") <dir>" >&2
    exit 1
fi

if [ ! -d "$1" ]; then
    echo "Invalid dir specified: '${1}'"
    exit 1
fi

# Subshell so we don't end up in a different dir than where we started.
(
    cd "$1"
    for sub in *; do
        [ -d "${sub}/.git" ] || continue
        echo "$sub [$(cd "$sub"; git  branch | grep '^\*' | cut -d' ' -f2)]"
        echo "$(cd "$sub"; git status -s)"
    done
)
